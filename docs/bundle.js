!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";exports.__esModule=!0;var transforms=require("../transforms"),formatters=require("../formatters"),config_1=require("../policy-mode/config");exports.SUMMARY_TITLE="Summary",exports.SUMMARY_FIELDS=[{field:"co2",title:"Carbon emissions impact (Mt CO2/yr)",extractor:function(view){return view.summary.co2},formatter:formatters.largeNumberFormatter},{field:"cost",title:"Cost impact ($USD/MWh)",extractor:function(view){return transforms.totalCost(view)},formatter:formatters.currencyFormatter}],exports.POLICY_TITLE="Policy choices",exports.POLICY_FIELDS=[{field:"rps",title:"Clean energy fraction (% of generation)",extractor:function(view){return view.choices.rps},formatter:config_1.dimensionLevelFormatters.rps},{field:"rps_includes_nuclear_energy",title:"Clean energy includes nuclear",extractor:function(view){return view.choices.rps_includes_nuclear_energy},formatter:config_1.dimensionLevelFormatters.rps_includes_nuclear_energy},{field:"rps_includes_carbon_capture",title:"Clean energy includes CCS",extractor:function(view){return view.choices.rps_includes_carbon_capture},formatter:config_1.dimensionLevelFormatters.rps_includes_carbon_capture},{field:"carbon_tax",title:"Clean energy fraction (% of generation)",extractor:function(view){return view.choices.rps},formatter:config_1.dimensionLevelFormatters.rps},{field:"nuclear_allowed",title:"Nuclear power allowed",extractor:function(view){return view.choices.nuclear_allowed},formatter:config_1.dimensionLevelFormatters.nuclear_allowed},{field:"storage_allowed",title:"Energy storage is allowed",extractor:function(view){return view.choices.storage_allowed},formatter:config_1.dimensionLevelFormatters.storage_allowed},{field:"ng_price",title:"Natural gas fuel price",extractor:function(view){return view.choices.ng_price},formatter:config_1.dimensionLevelFormatters.ng_price},{field:"solar_price",title:"Solar plant price",extractor:function(view){return view.choices.solar_price},formatter:config_1.dimensionLevelFormatters.solar_price},{field:"wind_price",title:"Wind plant price",extractor:function(view){return view.choices.wind_price},formatter:config_1.dimensionLevelFormatters.wind_price},{field:"nuclear_price",title:"Nuclear plant price",extractor:function(view){return view.choices.nuclear_price},formatter:config_1.dimensionLevelFormatters.nuclear_price}],exports.COST_TITLE="Cost breakdown",exports.COST_FIELDS=[{field:"storage_cost",title:"energy storage",extractor:function(view){return transforms.resourceCost(view,"storage")},formatter:formatters.currencyFormatter},{field:"solar_cost",title:"solar cost",extractor:function(view){return transforms.resourceCost(view,"solar")},formatter:formatters.currencyFormatter},{field:"wind_cost",title:"wind cost",extractor:function(view){return transforms.resourceCost(view,"wind")},formatter:formatters.currencyFormatter},{field:"nuclear_cost",title:"nuclear cost",extractor:function(view){return transforms.resourceCost(view,"nuclear")},formatter:formatters.currencyFormatter},{field:"ng_cost",title:"NG cost",extractor:function(view){return transforms.resourceCost(view,"ng")},formatter:formatters.currencyFormatter},{field:"ngccs_cost",title:"NG + CCS cost",extractor:function(view){return transforms.resourceCost(view,"ngccs")},formatter:formatters.currencyFormatter},{field:"coal_cost",title:"coal cost",extractor:function(view){return transforms.resourceCost(view,"coal")},formatter:formatters.currencyFormatter},{field:"coalccs_cost",title:"coal + CCS cost",extractor:function(view){return transforms.resourceCost(view,"coalccs")},formatter:formatters.currencyFormatter},{field:"hydro_cost",title:"NG cost",extractor:function(view){return transforms.resourceCost(view,"ng")},formatter:formatters.currencyFormatter},{field:"cost",title:"Total cost ($USD/MWh)",extractor:function(view){return transforms.totalCost(view)},formatter:formatters.currencyFormatter}],exports.ENERGY_TITLE="Energy breakdown",exports.ENERGY_FIELDS=[{field:"solar_energy",title:"solar generation",extractor:function(view){return transforms.energyFraction(view,"solar")},formatter:formatters.fractionMWhFormatter},{field:"wind_cost",title:"wind generation",extractor:function(view){return transforms.energyFraction(view,"wind")},formatter:formatters.fractionMWhFormatter},{field:"nuclear_cost",title:"nuclear generation",extractor:function(view){return transforms.energyFraction(view,"nuclear")},formatter:formatters.fractionMWhFormatter},{field:"ng_cost",title:"NG generation",extractor:function(view){return transforms.energyFraction(view,"ng")},formatter:formatters.fractionMWhFormatter},{field:"ngccs_cost",title:"NG + CCS generation",extractor:function(view){return transforms.energyFraction(view,"ngccs")},formatter:formatters.fractionMWhFormatter},{field:"coal_cost",title:"coal generation",extractor:function(view){return transforms.energyFraction(view,"coal")},formatter:formatters.fractionMWhFormatter},{field:"coalccs_cost",title:"coal + CCS generation",extractor:function(view){return transforms.energyFraction(view,"coalccs")},formatter:formatters.fractionMWhFormatter},{field:"hydro_cost",title:"NG generation",extractor:function(view){return transforms.energyFraction(view,"ng")},formatter:formatters.fractionMWhFormatter},{field:"energy",title:"Total energy",extractor:function(view){return 1},formatter:formatters.fractionMWhFormatter}]},{"../formatters":14,"../policy-mode/config":23,"../transforms":28}],2:[function(require,module,exports){"use strict";exports.__esModule=!0;var comps_table_1=require("../components/comps-table"),text_view_1=require("../components/text-view"),config=require("./config"),config_1=require("../policy-mode/config"),CompareController=function(){function CompareController(){}return CompareController.prototype.init=function(comps,selection){this._view={selection:selection,comps:comps},this._shareLink=new text_view_1.InputTextView(document.getElementById("share-link"));var compKeys=Object.keys(this._view.comps);compKeys.sort(),this._components=[new comps_table_1.CompsTable(document.getElementById("compare-mode-summary-table"),this._view,compKeys,config.SUMMARY_FIELDS,config_1.PRESET_POLICY_DISPLAY_NAMES,config.SUMMARY_TITLE),new comps_table_1.CompsTable(document.getElementById("compare-mode-policy-table"),this._view,compKeys,config.POLICY_FIELDS,config_1.PRESET_POLICY_DISPLAY_NAMES,config.POLICY_TITLE),new comps_table_1.CompsTable(document.getElementById("compare-mode-cost-table"),this._view,compKeys,config.COST_FIELDS,config_1.PRESET_POLICY_DISPLAY_NAMES,config.COST_TITLE),new comps_table_1.CompsTable(document.getElementById("compare-mode-energy-table"),this._view,compKeys,config.ENERGY_FIELDS,config_1.PRESET_POLICY_DISPLAY_NAMES,config.ENERGY_TITLE)]},CompareController.prototype.update=function(newSelectedPolicy){var _this=this;this._view.selection=newSelectedPolicy,this._components.forEach(function(c){return c.update(_this._view)}),this._shareLink.update(window.location.href)},CompareController}();exports.CompareController=CompareController},{"../components/comps-table":5,"../components/text-view":12,"../policy-mode/config":23,"./config":1}],3:[function(require,module,exports){"use strict";function updateUrlForAppState(state,schema,location,history){updateUrlNoRefresh(generateUrl(state,schema,location),history)}function readAppStateFromUrl(schema,location){var params=new URLSearchParams(location.search),stateToken=params.get(STATE_TOKEN_KEY);return null!==stateToken?decodeStateToken(stateToken,schema):null}function encodeStateToken(state,policySchema){var stateVector=[];return policySchema.dimensions.forEach(function(dimension){stateVector.push(state.policy[dimension])}),util.base64Encode(stateVector)}function decodeStateToken(stateToken,policySchema){var stateVector;try{stateVector=util.base64Decode(stateToken)}catch(error){throw new Error('Failed to decode base-64 app state token: "'+stateToken+'"')}var policy={};policySchema.dimensions.forEach(function(dimension,i){policy[dimension]=stateVector[i]});var state={policy:policy};return policySchema.dimensions.forEach(function(dimension){if(void 0===state.policy[dimension])throw new Error('Decoded app state token is missing required policy config dimension "'+dimension+'"')}),state}function generateUrl(state,schema,location){var params=new URLSearchParams(location.search),stateToken=encodeStateToken(state,schema);return params.set(STATE_TOKEN_KEY,stateToken),location.origin+location.pathname+"?"+params.toString()}function updateUrlNoRefresh(newUrl,history){history.replaceState({},"",newUrl)}exports.__esModule=!0;var util=require("../util"),STATE_TOKEN_KEY="state";exports.updateUrlForAppState=updateUrlForAppState,exports.readAppStateFromUrl=readAppStateFromUrl,exports.encodeStateToken=encodeStateToken,exports.decodeStateToken=decodeStateToken},{"../util":29}],4:[function(require,module,exports){"use strict";function _getMarkerLayout(x,threshold,offsetDistance,maxPlacement){var anchor,offset;return x<threshold?(anchor="start",offset=-offsetDistance):x>maxPlacement-threshold?(anchor="end",offset=+offsetDistance):(anchor="middle",offset=0),{anchor:anchor,offset:offset}}exports.__esModule=!0;var formatters=require("../formatters"),util=require("../util"),DEFAULT_CONFIG={data:{max:1,markers:[{value:0,label:""},{value:1,label:""},{value:.2,label:"Goal"},{value:.6,label:"Today"}]},bar:{width:270,height:50},padding:{left:10,right:15,top:6,bottom:50},ticks:{size:10,valueGap:15,labelGap:16,alignThreshold:50,xOffset:3},text:{offset:{x:8,y:6}},transition:{delay:50,duration:100}},CO2GoalChart=function(){function CO2GoalChart(container,view,configOverrides){this._container=container,this._config={},this._build(view,configOverrides)}return CO2GoalChart.prototype.update=function(view){this._bar.transition(this._transition).attr("width",this._co2Scale(view.summary.co2)),this._text.text(formatters.largeNumberFormatter(view.summary.co2)+"t CO2/yr")},CO2GoalChart.prototype._build=function(view,configOverrides){util.mergeDeep(DEFAULT_CONFIG,this._config),util.mergeDeep(configOverrides,this._config),this._configureLayout(view);var dataLayer=this._createChart();this._createDataElements(dataLayer),this.update(view)},CO2GoalChart.prototype._configureLayout=function(view){this._transition=d3.transition().delay(this._config.transition.delay).duration(this._config.transition.duration),this._co2Scale=d3.scale.linear().nice().domain([0,this._config.data.max]).rangeRound([0,this._config.bar.width]),this._co2Scale.clamp(!0)},CO2GoalChart.prototype._createChart=function(){var container=d3.select(this._container).classed("co2-chart-container",!0),pad=this._config.padding,width=this._config.bar.width+pad.left+pad.right,height=this._config.bar.height+pad.top+pad.bottom,svg=container.append("svg").classed("co2-chart",!0).style("margin-left","-"+pad.left+"px").attr("width",width).attr("height",height),dataLayer=svg.append("g").classed("co2-chart-bar-group",!0).attr("transform","translate("+pad.left+","+pad.top+")");dataLayer.append("rect").classed("co2-chart-bar-box",!0).attr("x",0).attr("y",0).attr("width",this._config.bar.width).attr("height",this._config.bar.height);return dataLayer},CO2GoalChart.prototype._createDataElements=function(parent){this._bar=parent.append("rect").classed("co2-chart-bar",!0).attr("x",0).attr("y",0).attr("width",this._co2Scale(0)).attr("height",this._config.bar.height),this._text=parent.append("text").classed("co2-chart-title",!0).text("").attr("x",this._config.padding.left+this._config.text.offset.x).attr("y",this._config.bar.height/2+this._config.text.offset.y);var markers=parent.selectAll(".co2-chart-marker").data(this._config.data.markers);markers.enter().append("g").classed(".co2-chart-marker",!0);var self=this;markers.each(function(d,i){self._createMarker(d3.select(this),d.value,d.label)})},CO2GoalChart.prototype._createMarker=function(parent,co2,label){var _this=this,xCoord=this._co2Scale(co2),layout=_getMarkerLayout(xCoord,this._config.ticks.alignThreshold,this._config.ticks.xOffset,this._config.bar.width),tickValuePlacement=(parent.append("line").classed("co2-chart-ticks-tick",!0).attr("x1",function(d){return _this._co2Scale(d.value)}).attr("x2",function(d){return _this._co2Scale(d.value)}).attr("y1",this._config.bar.height).attr("y2",this._config.bar.height+this._config.ticks.size),this._config.bar.height+this._config.ticks.size+this._config.ticks.valueGap);parent.append("text").classed("co2-chart-ticks-value",!0).attr("text-anchor",layout.anchor).attr("x",function(d){return _this._co2Scale(d.value)+layout.offset}).attr("y",tickValuePlacement).text(formatters.largeNumberFormatter(co2)),parent.append("text").classed("co2-chart-ticks-name",!0).text(function(d){return d.label}).attr("text-anchor","middle").attr("x",function(d){return _this._co2Scale(d.value)}).attr("y",function(){return tickValuePlacement+_this._config.ticks.labelGap})},CO2GoalChart}();exports.CO2GoalChart=CO2GoalChart,exports._getMarkerLayout=_getMarkerLayout},{"../formatters":14,"../util":29}],5:[function(require,module,exports){"use strict";exports.__esModule=!0;var CompsTable=function(){function CompsTable(container,view,comps,fields,compDisplayNames,title){this._container=container,this._fields=fields,this._comps=comps,this._referenceDisplayNames=compDisplayNames,this._title=title,this._build(view)}return CompsTable.prototype._build=function(view){var container=d3.select(this._container).classed("comps-table-container",!0);this._table=container.append("table").classed("comps-table-table",!0),this.update(view)},CompsTable.prototype.update=function(view){this._updateHeader(this._table,view);var rows=this._table.selectAll(".comps-table-row").data(this._fields);rows.enter().append("tr").classed("comps-table-row",!0),rows.exit().remove();var self=this;rows.each(function(field,i){self._updateRow(d3.select(this),view,field)})},CompsTable.prototype._updateRow=function(row,view,field){var titleCells=row.selectAll("td.title").data([field]);titleCells.enter().append("td").classed("title",!0),titleCells.exit().remove(),titleCells.text(function(d){return d.title});var userValue=field.extractor(view.selection),userData={value:userValue,displayValue:field.formatter(userValue)},userCells=row.selectAll("td.user").data([userData]);userCells.enter().append("td").classed("user",!0),userCells.exit().remove(),userCells.text(function(d){return d.displayValue});var compValues=this._comps.map(function(comp){var value=field.extractor(view.comps[comp]);return{value:value,displayValue:field.formatter(value)}}),compCells=row.selectAll("td.comps").data(compValues);compCells.enter().append("td").classed("comps",!0),compCells.exit().remove(),compCells.text(function(d){return d.displayValue})},CompsTable.prototype._updateHeader=function(table,view){var _this=this,compDisplayNames=this._comps.map(function(comp){return _this._referenceDisplayNames[comp]}),columnDisplayValues=[this._title,"Your policy"].concat(compDisplayNames),headerRows=table.selectAll("tr.comps-table-row-header").data([columnDisplayValues]);headerRows.enter().append("tr").classed("comps-table-row-header",!0),headerRows.exit().remove(),headerRows.each(function(rowData,i){var headerCells=d3.select(this).selectAll("td").data(rowData);headerCells.enter().append("td"),headerCells.exit().remove(),headerCells.text(function(compName){return compName}).classed("column-name",function(d){return!!d})})},CompsTable}();exports.CompsTable=CompsTable},{}],6:[function(require,module,exports){"use strict";exports.__esModule=!0;var formatters=require("../formatters"),transforms=require("../transforms"),text_view_1=require("./text-view"),TotalCost=function(){function TotalCost(container){this._textView=new text_view_1.TextView(container,formatters.currencyFormatter)}return TotalCost.prototype.update=function(view){this._textView.update(transforms.totalCost(view))},TotalCost}();exports.TotalCost=TotalCost;var BaselineDeltaCost=function(){function BaselineDeltaCost(container){this._textView=new text_view_1.TextView(container,formatters.currencyFormatter)}return BaselineDeltaCost.prototype.update=function(view){this._textView.update(transforms.baselineDeltaCost(view))},BaselineDeltaCost}();exports.BaselineDeltaCost=BaselineDeltaCost;var BaselineCost=function(){function BaselineCost(container){this._textView=new text_view_1.TextView(container,formatters.currencyFormatter)}return BaselineCost.prototype.update=function(view){this._textView.update(transforms.baselineCost(view))},BaselineCost}();exports.BaselineCost=BaselineCost},{"../formatters":14,"../transforms":28,"./text-view":12}],7:[function(require,module,exports){"use strict";function getBreakdownTableLayout(view,sources,sourceDisplayNames){var rows=[];return rows.push({type:"header",source:null,title:"Sources",values:["Energy","Cost"]}),sources.forEach(function(source){rows.push({type:"body",source:source,title:sourceDisplayNames[source]||source,values:[getDisplayEnergyContribution(view,source),formatters.currencyFormatter(transforms.resourceCost(view,source))]})}),rows.push({type:"footer",source:null,title:"Total",values:["1.00 MWh",formatters.currencyFormatter(transforms.totalCost(view))]}),rows}function getDisplayEnergyContribution(view,source){if("storage"==source)return"-";var fraction=transforms.energyFraction(view,source);return formatters.fractionMWhFormatter(fraction)}exports.__esModule=!0;var config=require("../policy-mode/config"),transforms=require("../transforms"),formatters=require("../formatters"),PolicyBreakdownTable=function(){function PolicyBreakdownTable(container,view,order,displayNames){this._container=container,this._order=order,this._displayNames=displayNames,this._build(view)}return PolicyBreakdownTable.prototype._build=function(view){var container=d3.select(this._container).classed("policy-breakdown-table-container",!0);this._table=container.append("table").classed("policy-breakdown-table-table",!0),this.update(view)},PolicyBreakdownTable.prototype.update=function(view){var layout=getBreakdownTableLayout(view,this._order,this._displayNames),ROW_CSS="policy-breakdown-table-row",rows=this._table.selectAll("."+ROW_CSS).data(layout);rows.enter().append("tr").classed(ROW_CSS,!0),rows.exit().remove(),rows.classed("header",function(d){return"header"==d.type}),rows.classed("body",function(d){return"body"==d.type}),rows.classed("footer",function(d){return"footer"==d.type});var self=this;rows.each(function(rowData,i){self._updateRow(d3.select(this),rowData)})},PolicyBreakdownTable.prototype._updateRow=function(row,rowData){var titleCells=row.selectAll("td.title").data([rowData]);titleCells.enter().append("td").classed("title",!0),titleCells.exit().remove(),titleCells.text(function(d){return d.title}).style("color",function(d){return config.BREAKDOWN_COLORS[d.source]||"inherit"});var valueCells=row.selectAll("td.value").data(rowData.values);valueCells.enter().append("td").classed("value",!0),valueCells.exit().remove(),valueCells.text(function(d){return d})},PolicyBreakdownTable}();exports.PolicyBreakdownTable=PolicyBreakdownTable,exports.getBreakdownTableLayout=getBreakdownTableLayout},{"../formatters":14,"../policy-mode/config":23,"../transforms":28}],8:[function(require,module,exports){"use strict";function _getTimeScaleTicks(times){var ticks=[];if(times.forEach(function(t){12==t.getUTCHours()&&ticks.push(t)}),!ticks.length)throw new Error("Expected time series to contain at least one UTC noon time point");return ticks}function _getPowerScaleTicks(demand){function truncateThousands(value){return 1e3*Math.floor(value/1e3)}var _a=d3.extent(demand),minDemand=_a[0],maxDemand=_a[1];return[0,truncateThousands(minDemand),truncateThousands(maxDemand)]}function _createSpeckledPattern(defs,patternId,backgroundColor,foregroundColor){var pattern=defs.append("pattern").attr("id",patternId).attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5);return pattern.append("rect").attr("width",5).attr("height",5).attr("fill",backgroundColor),pattern.append("rect").attr("width",1).attr("height",1).attr("fill",foregroundColor),pattern}function _createSolidPattern(defs,patternId,color){var pattern=defs.append("pattern").attr("id",patternId).attr("patternUnits","userSpaceOnUse").attr("width",30).attr("height",30);return pattern.append("rect").attr("width",30).attr("height",30).attr("fill",color),pattern}function _getDemandSeries(view){return view.profiles.index.map(function(t,i){return{timestamp:new Date(t),power:view.profiles.series.demand[i]}})}function getUnstackedSupplyLayout(view,order){var stackedData={};return order.forEach(function(source){stackedData[source]=[]}),view.profiles.index.map(function(timestamp,i){order.forEach(function(source){stackedData[source].push({x:new Date(timestamp),y:view.profiles.series[source][i]})})}),order.map(function(s){return stackedData[s]})}function getConsumedLayout(view){var series=view.profiles.series,points=view.profiles.index.map(function(t,i){return{x:new Date(t),y:Math.min(series.supply[i],series.demand[i]),defined:series.supply[i]>0&&series.supply[i]<=series.supply[i]}});return defineIntervalEndpoints(points),points}function getExcessLayout(view){var series=view.profiles.series,points=view.profiles.index.map(function(t,i){return{x:new Date(t),y0:series.demand[i],y1:series.supply[i],defined:series.supply[i]>series.demand[i]}});return defineIntervalEndpoints(points),points}function getExcessMarkerLayout(profiles,showThreshold,maxPlacement){var markers=[],maxExcess={excessValue:0,placementValue:null,timestamp:null};return profiles.index.forEach(function(t,i){var generated=profiles.series.supply[i],demand=profiles.series.demand[i],excess=Math.max(generated-demand,0);excess>maxExcess.excessValue&&(maxExcess.excessValue=excess,maxExcess.placementValue=Math.min(generated,maxPlacement),maxExcess.timestamp=new Date(t))}),maxExcess.excessValue>showThreshold&&markers.push(maxExcess),markers}function defineIntervalEndpoints(series){var length=series.length;series.map(function(point,i){var isDefined=point.defined;return isDefined||(i>0&&(isDefined=isDefined||series[i-1].defined),i<length-1&&(isDefined=isDefined||series[i+1].defined)),isDefined}).forEach(function(isDefined,i){return series[i].defined=isDefined})}exports.__esModule=!0;var style=require("../style"),util=require("../util"),DEFAULT_CONFIG={size:{width:760,height:330},padding:{top:5,left:50,bottom:30,right:0},labels:{yAxis:"Power (Gigawatts)",excessMarker:"Excess"},layout:{markers:{labelYOffset:-12,labelYGap:-6,labelMaxYValue:28e3}},behavior:{showExcessLabelThreshold:5e3},colors:{solar:style.COLORS.SOLAR_LIGHT,wind:style.COLORS.WIND,nuclear:style.COLORS.NUCLEAR,ng:style.COLORS.NG,ngccs:style.COLORS.NGCCS,coal:style.COLORS.COAL,coalccs:style.COLORS.COALCCS,demand:style.COLORS.DEMAND,excess:style.COLORS.EXCESS,patternBackground:style.COLORS.EXCESS_LIGHT,markers:"#ccc"},transition:{delay:50,duration:100},patterns:{solar:"solar-consumed",wind:"wind-consumed",nuclear:"nuclear-consumed",ng:"ng-consumed",ngccs:"ngccs-consumed",coal:"coal-consumed",coalccs:"coalccs-consumed",demand:"demand-primary",excess:"excess-primary"},stackingOrder:["coal","coalccs","nuclear","solar","wind","ng","ngccs"]},SupplyDemandProfilesChart=function(){function SupplyDemandProfilesChart(container,view,configOverrides){this._container=container,this._config={},this._build(view,configOverrides)}return SupplyDemandProfilesChart.prototype.update=function(view){var _this=this,unstackedLayoutData=getUnstackedSupplyLayout(view,this._config.stackingOrder),stackedLayoutData=this._supplyRegionLayout(unstackedLayoutData),supplyRegions=this._supplyLayer.selectAll("path").data(stackedLayoutData);supplyRegions.enter().append("path").classed("supply-area",!0);var fills=this._config.stackingOrder.map(function(s){return"url(#"+_this._config.patterns[s]+")"});supplyRegions.attr("fill",function(d,i){return fills[i]}).attr("d",this._supplyPathGenerator);var excessSeries=getExcessLayout(view);this._excessRegion.datum(excessSeries).attr("fill","url(#"+this._config.patterns.excess+")").attr("d",this._excessPathGenerator),this._excessBorder.datum(excessSeries).attr("d",this._excessBorderPathGenerator);var consumedSeries=getConsumedLayout(view);this._consumedBorder.datum(consumedSeries).attr("d",this._consumedPathGenerator);var markerPoints=this._getInterestMarkersLayout(view),labels=this._excessMarkerLayer.selectAll(".interest-marker-label").data(markerPoints);labels.enter().append("text").classed("interest-marker-label",!0).text(function(d){return d.label}).style("text-anchor","middle"),labels.exit().remove(),labels.attr("x",function(d){return d.x}).attr("y",function(d){return d.labelYOffset+d.labelYGap});var arrows=this._excessMarkerLayer.selectAll(".interest-marker-arrow").data(markerPoints,function(d){return String(d.x)});arrows.enter().append("line").classed("interest-marker-arrow",!0),arrows.exit().remove(),arrows.attr("x1",function(d){return d.x}).attr("y1",function(d){return d.y}).attr("x2",function(d){return d.x}).attr("y2",function(d){return d.labelYOffset}).style("stroke",function(d){return d.color});var demandSeries=_getDemandSeries(view);this._demandRegion.datum(demandSeries).attr("d",this._demandPathGenerator),this._demandBorder.datum(demandSeries).attr("d",this._demandBorderPathGenerator)},SupplyDemandProfilesChart.prototype._build=function(view,configOverrides){util.mergeDeep(DEFAULT_CONFIG,this._config),util.mergeDeep(configOverrides,this._config),this._configureLayout(view),this._configureGenerators();var axesLayer=this._createChart();this._createDataLayers(axesLayer),this.update(view)},SupplyDemandProfilesChart.prototype._configureLayout=function(view){this._transition=d3.transition().delay(this._config.transition.delay).duration(this._config.transition.duration),this._timeScale=d3.time.scale().rangeRound([0,this._config.size.width]),this._powerScale=d3.scale.linear().range([this._config.size.height,0]);var demandSeries=_getDemandSeries(view);this._timeScale.domain(d3.extent(demandSeries.map(function(d){return d.timestamp}))),this._powerScale.domain([0,d3.max(demandSeries.map(function(d){return d.power}))]);var xTicks=_getTimeScaleTicks(demandSeries.map(function(d){return d.timestamp}));this._xAxisGenerator=d3.svg.axis().scale(this._timeScale).orient("bottom").tickFormat(d3.time.format("%A")).tickValues(xTicks);var yTicks=_getPowerScaleTicks(view.profiles.series.demand);this._yAxisGenerator=d3.svg.axis().scale(this._powerScale).orient("left").tickFormat(function(d){return String(d/1e3)}).tickValues(yTicks)},SupplyDemandProfilesChart.prototype._configureGenerators=function(){var _this=this;this._demandPathGenerator=d3.svg.area().x(function(d,i){return _this._timeScale(d.timestamp)}).y0(function(d){return _this._powerScale(0)}).y1(function(d){return _this._powerScale(d.power)}),this._demandBorderPathGenerator=d3.svg.line().x(function(d){return _this._timeScale(d.timestamp)}).y(function(d){return _this._powerScale(d.power)}).interpolate("basis");this._supplyPathGenerator=d3.svg.area().x(function(d){return _this._timeScale(d.x)}).y0(function(d){return _this._powerScale(d.y0)}).y1(function(d){return _this._powerScale(d.y0+d.y)}),this._supplyRegionLayout=d3.layout.stack(),this._excessPathGenerator=d3.svg.area().x(function(d,i){return _this._timeScale(d.x)}).y0(function(d){return _this._powerScale(d.y0)}).y1(function(d){return _this._powerScale(d.y1)}).defined(function(d){return d.defined}),this._excessBorderPathGenerator=d3.svg.line().x(function(d){return _this._timeScale(d.x)}).y(function(d){return _this._powerScale(d.y1)}).defined(function(d){return d.defined}),this._consumedPathGenerator=d3.svg.line().x(function(d){return _this._timeScale(d.x)}).y(function(d){return _this._powerScale(d.y)}).defined(function(d){return d.defined})},SupplyDemandProfilesChart.prototype._createChart=function(){var _this=this,container=d3.select(this._container).classed("supply-demand-chart-container",!0),width=this._config.size.width+this._config.padding.left+this._config.padding.right,height=this._config.size.height+this._config.padding.top+this._config.padding.bottom,svg=container.append("svg").classed("supply-demand-chart",!0).style("margin-left","-"+(this._config.padding.left-5)+"px").attr("width",width).attr("height",height),defs=svg.append("defs");_createSolidPattern(defs,this._config.patterns.demand,this._config.colors.demand),_createSpeckledPattern(defs,this._config.patterns.excess,this._config.colors.patternBackground,this._config.colors.excess),this._config.stackingOrder.forEach(function(source){_createSolidPattern(defs,source+"-consumed",_this._config.colors[source])});var axesLayer=svg.selectAll(".supply-demand-chart-bar-group").data([0]);return axesLayer.enter().append("g"),axesLayer.classed("supply-demand-chart-bar-group",!0).attr("transform","translate("+this._config.padding.left+","+this._config.padding.top+")"),axesLayer},SupplyDemandProfilesChart.prototype._createDataLayers=function(parent){this._demandRegion=parent.append("path").attr("class","area").attr("fill","url(#"+this._config.patterns.demand+")"),this._demandBorder=parent.append("path").classed("demand-curve-line",!0),this._supplyLayer=parent.append("g").classed("supply-regions",!0),this._excessLayer=parent.append("g").classed("excess-group",!0),this._excessRegion=this._excessLayer.append("path").attr("class","area"),this._excessBorder=this._excessLayer.append("path").classed("excess-curve-line",!0),this._consumedLayer=parent.append("g").classed("consumed-curve",!0),this._consumedBorder=this._consumedLayer.append("path").classed("consumed-curve-line",!0);var yAxisLayer=(parent.append("g").attr("class","x axis").attr("transform","translate(0,"+this._config.size.height+")").call(this._xAxisGenerator),parent.append("g").attr("class","y axis").call(this._yAxisGenerator));yAxisLayer.append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(this._config.labels.yAxis),parent.append("line").attr("class","bounding-box right-wall").attr("x1",this._config.size.width).attr("x2",this._config.size.width).attr("y1",0).attr("y2",this._config.size.height);this._excessMarkerLayer=parent.append("g").attr("class","excess-marker-group")},SupplyDemandProfilesChart.prototype._getInterestMarkersLayout=function(view){var _this=this;return getExcessMarkerLayout(view.profiles,this._config.behavior.showExcessLabelThreshold,this._config.layout.markers.labelMaxYValue).map(function(p){var point={x:_this._timeScale(p.timestamp),y:_this._powerScale(p.placementValue),labelYOffset:0,labelYGap:_this._config.layout.markers.labelYGap,color:_this._config.colors.markers,label:_this._config.labels.excessMarker};return point.labelYOffset=point.y+_this._config.layout.markers.labelYOffset,point})},SupplyDemandProfilesChart}();exports.SupplyDemandProfilesChart=SupplyDemandProfilesChart,exports._getTimeScaleTicks=_getTimeScaleTicks,exports._getPowerScaleTicks=_getPowerScaleTicks,exports._createSpeckledPattern=_createSpeckledPattern,exports._createSolidPattern=_createSolidPattern,exports._getDemandSeries=_getDemandSeries,exports.getUnstackedSupplyLayout=getUnstackedSupplyLayout,exports.getConsumedLayout=getConsumedLayout,exports.getExcessLayout=getExcessLayout,exports.getExcessMarkerLayout=getExcessMarkerLayout,exports.defineIntervalEndpoints=defineIntervalEndpoints},{"../style":27,"../util":29}],9:[function(require,module,exports){"use strict";function initAppendixLinks(){var appendixLinks={about:{links:[document.getElementById("title-about-appendix")],
button:document.getElementById("go-to-about-appendix-button")},details:{links:[document.getElementById("title-details-appendix"),document.getElementById("cost-slider-about-appendix")],button:document.getElementById("go-to-details-appendix-button")},data:{links:[document.getElementById("title-data-appendix")],button:document.getElementById("go-to-data-appendix-button")},code:{links:[document.getElementById("title-code-appendix")],button:document.getElementById("go-to-code-appendix-button")}};Object.keys(appendixLinks).forEach(function(page){var _a=appendixLinks[page],links=_a.links,button=_a.button;links.forEach(function(link){link.onclick=function(event){event.preventDefault(),button.click()}})})}exports.__esModule=!0,exports.initAppendixLinks=initAppendixLinks},{}],10:[function(require,module,exports){"use strict";exports.__esModule=!0;var PresetOptionGroup=function(){function PresetOptionGroup(presetKeyToElement,onChangeCallback){this._onChangeCallback=onChangeCallback,this._presetOptions=this._createPresetGroup(presetKeyToElement)}return PresetOptionGroup.prototype.select=function(presetKey){this._onChangeCallback(presetKey),this.deselectAll(),this._presetOptions[presetKey].select()},PresetOptionGroup.prototype.deselectAll=function(){var _this=this;Object.keys(this._presetOptions).forEach(function(name){_this._presetOptions[name].deselect()})},PresetOptionGroup.prototype._createPresetGroup=function(presetKeyToElement){var _this=this,nameToPreset={};return Object.keys(presetKeyToElement).forEach(function(name){nameToPreset[name]=new PresetOption(presetKeyToElement[name],function(event){return _this.select(name)})}),nameToPreset},PresetOptionGroup}();exports.PresetOptionGroup=PresetOptionGroup;var PresetOption=function(){function PresetOption(checkboxElement,onPresetSelectCallback){this._checkboxElement=checkboxElement,this._onPresetSelectCallback=onPresetSelectCallback,this._build()}return PresetOption.prototype.select=function(){this._mdlToggle.check()},PresetOption.prototype.deselect=function(){this._mdlToggle.uncheck()},PresetOption.prototype._build=function(){var _this=this,materialToggleElement=this._checkboxElement.parentElement,mdlToggle=materialToggleElement.MaterialIconToggle;this._mdlToggle=mdlToggle,materialToggleElement.onclick=function(event){mdlToggle.check(),_this._onPresetSelectCallback()}},PresetOption}();exports.PresetOption=PresetOption},{}],11:[function(require,module,exports){"use strict";exports.__esModule=!0;var mdl=require("../mdl"),util=require("../util"),Slider=function(){function Slider(container,min,max,step,initialValue,scaleDisplayValues){if(this._container=container,this._range=null,this._onChangeCallbacks=[],scaleDisplayValues){var expectedScaleSize=(max-min)/step+1;if(scaleDisplayValues.length!=expectedScaleSize)throw new Error("Expected scale size "+expectedScaleSize+"\n            but was "+scaleDisplayValues.length)}this._scale=scaleDisplayValues,this._currentValue=initialValue,this._build(min,max,step,initialValue)}return Slider.prototype.addChangeListener=function(callback){this._onChangeCallbacks.push(callback)},Slider.prototype.setValue=function(value){this._range.MaterialSlider.change(value),this._currentValue=value,this._currentValueElement.textContent=this._scale[this._currentValue],this._notifyListeners(value)},Slider.prototype.disable=function(){this._range.MaterialSlider.disable()},Slider.prototype.enable=function(){this._range.MaterialSlider.enable()},Slider.prototype._build=function(min,max,step,initialValue){var _this=this;this._container.classList.add("slider-control-container");var range=document.createElement("input");range.type="range",range.classList.add("mdl-slider"),range.classList.add("mdl-js-slider"),range.min=String(min),range.max=String(max),step&&(range.step=String(step)),range.value=String(initialValue),this._currentValueElement=document.createElement("p"),this._currentValueElement.classList.add("slider-current-value"),this._container.appendChild(this._currentValueElement),this._currentValueElement.textContent=this._scale[this._currentValue];var sliderContainer=document.createElement("div");sliderContainer.classList.add("slider-container"),this._container.appendChild(sliderContainer),sliderContainer.appendChild(range),mdl.components.upgradeElement(range);var throttledChangeHandler=util.animate(function(event){_this._currentValue=parseFloat(event.target.value),_this._currentValueElement.textContent=_this._scale[_this._currentValue]},function(){_this._notifyListeners(_this._currentValue)});range.onchange=throttledChangeHandler,range.oninput=throttledChangeHandler,this._range=range;var labelContainer=document.createElement("div");labelContainer.classList.add("slider-tick-container"),sliderContainer.appendChild(labelContainer);var minLabel=document.createElement("span");minLabel.classList.add("slider-tick-value"),minLabel.classList.add("min"),this._scale?minLabel.textContent=this._scale[0]:minLabel.textContent=String(min),labelContainer.appendChild(minLabel);var maxLabel=document.createElement("span");maxLabel.classList.add("slider-tick-value"),maxLabel.classList.add("max"),this._scale?maxLabel.textContent=this._scale.slice(-1)[0]:maxLabel.textContent=String(max),labelContainer.appendChild(maxLabel)},Slider.prototype._notifyListeners=function(newValue){this._onChangeCallbacks.forEach(function(callback){return callback(newValue)})},Slider}();exports.Slider=Slider},{"../mdl":16,"../util":29}],12:[function(require,module,exports){"use strict";exports.__esModule=!0;var TextView=function(){function TextView(element,formatter){this.element=element,this.formatter=formatter||function(value){return String(value)}}return TextView.prototype.update=function(newValue){this.element.textContent=this.formatter(newValue)},TextView}();exports.TextView=TextView;var InputTextView=function(){function InputTextView(element,formatter){this.element=element,this.formatter=formatter||function(value){return String(value)}}return InputTextView.prototype.update=function(newValue){this.element.value=this.formatter(newValue),this.element.selectionDirection="forward",this.element.selectionStart=0,this.element.selectionEnd=1e3,this.element.maxLength=1e3,this.element.width=String(300)},InputTextView}();exports.InputTextView=InputTextView},{}],13:[function(require,module,exports){"use strict";exports.__esModule=!0;var OptionToggle=function(){function OptionToggle(checkbox){this._checkbox=checkbox,this._onChangeCallbacks=[],this._checkbox.onchange=this._handleChangeEvent.bind(this);var materialWrapper=this._checkbox.parentElement;if(!materialWrapper||!materialWrapper.MaterialCheckbox)throw new Error("Cannot create toggle control from checkbox element "+checkbox.id+"because checkbox has not been upgraded to a MDL checkbox.");this._materialCheckbox=materialWrapper.MaterialCheckbox}return OptionToggle.prototype.addChangeListener=function(callback){this._onChangeCallbacks.push(callback)},OptionToggle.prototype.getValue=function(){return this._checkbox.checked},OptionToggle.prototype.enable=function(){this._materialCheckbox.enable()},OptionToggle.prototype.disable=function(){this._materialCheckbox.disable()},OptionToggle.prototype.setValue=function(isEnabled){this._checkbox.checked!==isEnabled&&this._checkbox.click()},OptionToggle.prototype._handleChangeEvent=function(event){var _this=this;this._onChangeCallbacks.forEach(function(callback){callback(_this.getValue())})},OptionToggle}();exports.OptionToggle=OptionToggle},{}],14:[function(require,module,exports){"use strict";function getSign(value){return value<0?"-":"+"}function percentFormatter(fraction){return""+getSign(fraction)+Math.floor(100*Math.abs(fraction))+"%"}function percentFormatterNoSign(fraction){return Math.floor(100*Math.abs(fraction))+"%"}function fractionMWhFormatter(fractionMWh){return fractionMWh.toFixed(2)+" MWh"}function d3_formatPrefix(d,i){var k=Math.pow(10,3*Math.abs(8-i));return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}function configure(){d3.formatPrefix=function(value,precision){var i=0;return value&&(value<0&&(value*=-1),precision&&(value=d3.round(value,d3_format_precision(value,precision))),i=1+Math.floor(1e-12+Math.log(value)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i-1)/3)))),d3_formatPrefixes[8+i/3]}}exports.__esModule=!0;var _baseLargeNumberFormatter=d3.format(".3s");exports.largeNumberFormatter=function(value){return Math.abs(value)<1e-6?"0":_baseLargeNumberFormatter(value)},exports.currencyFormatter=d3.format("$,.2f"),exports.fractionFormatter=d3.format(".2f"),exports.percentDeltaFormatter=function(deltaFraction){var delta=Math.floor(100*deltaFraction);return(delta>=0?"▲":"▼")+Math.abs(delta)+"%"},exports.percentFormatter=percentFormatter,exports.percentFormatterNoSign=percentFormatterNoSign,exports.fractionMWhFormatter=fractionMWhFormatter;var d3_formatPrefixes=["e-24","e-21","e-18","e-15","e-12","e-9","e-6","e-3","","K","M","B","T","P","E","Z","Y"].map(d3_formatPrefix);exports.configure=configure},{}],15:[function(require,module,exports){"use strict";exports.__esModule=!0;var formatters=require("./formatters"),utility=require("./utility-mode/controller"),policy=require("./policy-mode/controller"),comp=require("./compare-mode/controller"),appendix=require("./components/layout"),util=require("./util"),es6_promise_1=require("es6-promise");require("url-search-params-polyfill"),es6_promise_1.polyfill(),formatters.configure();var scrollContainer=document.getElementById("scroll-container");util.selectElements(".mdl-tabs__tab .mdl-button").forEach(function(el){el.onclick=function(event){scrollContainer.scrollTop=0}});var utilityController=new utility.UtilityController("data/utility-dataset.json"),policyController=new policy.PolicyController(new comp.CompareController);window.addEventListener("load",function(event){console.debug("window.load",event),appendix.initAppendixLinks(),utilityController.init(),policyController.fetchAndInit("data/policy-schema.json","data/policy-dataset.csv")})},{"./compare-mode/controller":2,"./components/layout":9,"./formatters":14,"./policy-mode/controller":24,"./util":29,"./utility-mode/controller":31,"es6-promise":17,"url-search-params-polyfill":22}],16:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.components=componentHandler},{}],17:[function(require,module,exports){(function(process,global){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.ES6Promise=factory()}(this,function(){"use strict";function objectOrFunction(x){var type=typeof x;return null!==x&&("object"===type||"function"===type)}function isFunction(x){return"function"==typeof x}function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}function useVertxTimer(){return void 0!==vertxNext?function(){vertxNext(flush)}:useSetTimeout()}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}function flush(){for(var i=0;i<len;i+=2){(0,queue[i])(queue[i+1]),queue[i]=void 0,queue[i+1]=void 0}len=0}function then(onFulfillment,onRejection){var _arguments=arguments,parent=this,child=new this.constructor(noop);void 0===child[PROMISE_ID]&&makePromise(child);var _state=parent._state;return _state?function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}():subscribe(parent,child,onFulfillment,onRejection),child}function resolve$1(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(noop);return resolve(promise,object),promise}function noop(){}function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){return GET_THEN_ERROR.error=error,GET_THEN_ERROR}}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=!1,error=tryThen(then$$1,thenable,function(value){sealed||(sealed=!0,thenable!==value?resolve(promise,value):fulfill(promise,value))},function(reason){sealed||(sealed=!0,reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,reject(promise,error))},promise)}function handleOwnThenable(promise,thenable){thenable._state===FULFILLED?fulfill(promise,thenable._result):thenable._state===REJECTED?reject(promise,thenable._result):subscribe(thenable,void 0,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}function handleMaybeThenable(promise,maybeThenable,then$$1){maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1?handleOwnThenable(promise,maybeThenable):then$$1===GET_THEN_ERROR?(reject(promise,GET_THEN_ERROR.error),GET_THEN_ERROR.error=null):void 0===then$$1?fulfill(promise,maybeThenable):isFunction(then$$1)?handleForeignThenable(promise,maybeThenable,then$$1):fulfill(promise,maybeThenable)}function resolve(promise,value){promise===value?reject(promise,selfFulfillment()):objectOrFunction(value)?handleMaybeThenable(promise,value,getThen(value)):fulfill(promise,value)}function publishRejection(promise){promise._onerror&&promise._onerror(promise._result),publish(promise)}function fulfill(promise,value){promise._state===PENDING&&(promise._result=value,promise._state=FULFILLED,0!==promise._subscribers.length&&asap(publish,promise))}function reject(promise,reason){promise._state===PENDING&&(promise._state=REJECTED,promise._result=reason,asap(publishRejection,promise))}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers,length=_subscribers.length;parent._onerror=null,_subscribers[length]=child,_subscribers[length+FULFILLED]=onFulfillment,_subscribers[length+REJECTED]=onRejection,0===length&&parent._state&&asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child=void 0,callback=void 0,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function ErrorObject(){this.error=null}function tryCatch(callback,detail){try{return callback(detail)}catch(e){return TRY_CATCH_ERROR.error=e,TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){if(value=tryCatch(callback,detail),value===TRY_CATCH_ERROR?(failed=!0,error=value.error,value.error=null):succeeded=!0,promise===value)return void reject(promise,cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==PENDING||(hasCallback&&succeeded?resolve(promise,value):failed?reject(promise,error):settled===FULFILLED?fulfill(promise,value):settled===REJECTED&&reject(promise,value))}function initializePromise(promise,resolver){try{resolver(function(value){resolve(promise,value)},function(reason){reject(promise,reason)})}catch(e){reject(promise,e)}}function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++,promise._state=void 0,promise._result=void 0,promise._subscribers=[]}function Enumerator$1(Constructor,input){this._instanceConstructor=Constructor,this.promise=new Constructor(noop),this.promise[PROMISE_ID]||makePromise(this.promise),isArray(input)?(this.length=input.length,this._remaining=input.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(input),0===this._remaining&&fulfill(this.promise,this._result))):reject(this.promise,validationError())}function validationError(){return new Error("Array Methods must be provided an Array")}function all$1(entries){return new Enumerator$1(this,entries).promise}function race$1(entries){var Constructor=this;return new Constructor(isArray(entries)?function(resolve,reject){for(var length=entries.length,i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)}:function(_,reject){return reject(new TypeError("You must pass an array to race."))})}function reject$1(reason){var Constructor=this,promise=new Constructor(noop);return reject(promise,reason),promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise$2(resolver){this[PROMISE_ID]=nextId(),this._result=this._state=void 0,this._subscribers=[],noop!==resolver&&("function"!=typeof resolver&&needsResolver(),this instanceof Promise$2?initializePromise(this,resolver):needsNew())}function polyfill$1(){var local=void 0;if(void 0!==global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if("[object Promise]"===promiseToString&&!P.cast)return}local.Promise=Promise$2}var _isArray=void 0;_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var isArray=_isArray,len=0,vertxNext=void 0,customSchedulerFn=void 0,asap=function(callback,arg){queue[len]=callback,queue[len+1]=arg,2===(len+=2)&&(customSchedulerFn?customSchedulerFn(flush):scheduleFlush())},browserWindow="undefined"!=typeof window?window:void 0,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode="undefined"==typeof self&&void 0!==process&&"[object process]"==={}.toString.call(process),isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,queue=new Array(1e3),scheduleFlush=void 0;scheduleFlush=isNode?function(){return function(){return process.nextTick(flush)}}():BrowserMutationObserver?function(){var iterations=0,observer=new BrowserMutationObserver(flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}():isWorker?function(){var channel=new MessageChannel;return channel.port1.onmessage=flush,function(){return channel.port2.postMessage(0)}}():void 0===browserWindow&&"function"==typeof require?function(){try{var r=require,vertx=r("vertx");return vertxNext=vertx.runOnLoop||vertx.runOnContext,useVertxTimer()}catch(e){return useSetTimeout()}}():useSetTimeout();var PROMISE_ID=Math.random().toString(36).substring(16),PENDING=void 0,FULFILLED=1,REJECTED=2,GET_THEN_ERROR=new ErrorObject,TRY_CATCH_ERROR=new ErrorObject,id=0;return Enumerator$1.prototype._enumerate=function(input){for(var i=0;this._state===PENDING&&i<input.length;i++)this._eachEntry(input[i],i)},Enumerator$1.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor,resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if("function"!=typeof _then)this._remaining--,this._result[i]=entry;else if(c===Promise$2){var promise=new c(noop);handleMaybeThenable(promise,entry,_then),this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry)}),i)}else this._willSettleAt(resolve$$1(entry),i)},Enumerator$1.prototype._settledAt=function(state,i,value){var promise=this.promise;promise._state===PENDING&&(this._remaining--,state===REJECTED?reject(promise,value):this._result[i]=value),0===this._remaining&&fulfill(promise,this._result)},Enumerator$1.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,void 0,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})},Promise$2.all=all$1,Promise$2.race=race$1,Promise$2.resolve=resolve$1,Promise$2.reject=reject$1,Promise$2._setScheduler=setScheduler,Promise$2._setAsap=setAsap,Promise$2._asap=asap,Promise$2.prototype={constructor:Promise$2,then:then,catch:function(onRejection){return this.then(null,onRejection)}},Promise$2.polyfill=polyfill$1,Promise$2.Promise=Promise$2,Promise$2})}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:21}],18:[function(require,module,exports){"use strict";function iota(n){for(var result=new Array(n),i=0;i<n;++i)result[i]=i;return result}module.exports=iota},{}],19:[function(require,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)}},{}],20:[function(require,module,exports){function compare1st(a,b){return a[0]-b[0]}function order(){var i,stride=this.stride,terms=new Array(stride.length);for(i=0;i<terms.length;++i)terms[i]=[Math.abs(stride[i]),i];terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i)result[i]=terms[i][1];return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");dimension<0&&(className="View_Nil"+dtype);var useGetters="generic"===dtype;if(-1===dimension){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}",procedure=new Function(code);return procedure()}if(0===dimension){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}",procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"],indices=iota(dimension),args=indices.map(function(i){return"i"+i}),index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+"),shapeArg=indices.map(function(i){return"b"+i}).join(","),strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension),code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})"),1===dimension?code.push("proto.order=[0]"):(code.push("Object.defineProperty(proto,'order',{get:"),dimension<4?(code.push("function "+className+"_order(){"),2===dimension?code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===dimension&&code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):code.push("ORDER})")),code.push("proto.set=function "+className+"_set("+args.join(",")+",v){"),useGetters?code.push("return this.data.set("+index_str+",v)}"):code.push("return this.data["+index_str+"]=v}"),code.push("proto.get=function "+className+"_get("+args.join(",")+"){"),useGetters?code.push("return this.data.get("+index_str+")}"):code.push("return this.data["+index_str+"]}"),code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}"),code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}),c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}"),code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");for(var tShape=new Array(dimension),tStride=new Array(dimension),i=0;i<dimension;++i)tShape[i]="a[i"+i+"]",tStride[i]="b[i"+i+"]";code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}"),code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(isBuffer(data))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(data)?"array":"generic"}function wrappedNDArrayCtor(data,shape,stride,offset){if(void 0===data){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}"number"==typeof data&&(data=[data]),void 0===shape&&(shape=[data.length]);var d=shape.length;if(void 0===stride){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i)stride[i]=sz,sz*=shape[i]}if(void 0===offset){offset=0;for(var i=0;i<d;++i)stride[i]<0&&(offset-=(shape[i]-1)*stride[i])}for(var dtype=arrayDType(data),ctor_list=CACHED_CONSTRUCTORS[dtype];ctor_list.length<=d+1;)ctor_list.push(compileConstructor(dtype,ctor_list.length-1));var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}var iota=require("iota-array"),isBuffer=require("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array,CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=wrappedNDArrayCtor},{"iota-array":18,"is-buffer":19}],21:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){
throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],22:[function(require,module,exports){(function(global){!function(self){"use strict";function URLSearchParams(search){if(search=search||"",this[__URLSearchParams__]={},search instanceof URLSearchParams&&(search=search.toString()),"object"==typeof search){for(var i in search)if(search.hasOwnProperty(i)){var str="string"==typeof search[i]?search[i]:JSON.stringify(search[i]);this.append(i,str)}}else{0===search.indexOf("?")&&(search=search.slice(1));for(var pairs=search.split("&"),j=0;j<pairs.length;j++){var value=pairs[j],index=value.indexOf("=");-1<index&&this.append(decode(value.slice(0,index)),decode(value.slice(index+1)))}}}function encode(str){var replace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(str).replace(/[!'\(\)~]|%20|%00/g,function(match){return replace[match]})}function decode(str){return decodeURIComponent(str.replace(/\+/g," "))}function makeIterator(arr){var iterator={next:function(){var value=arr.shift();return{done:void 0===value,value:value}}};return iterable&&(iterator[self.Symbol.iterator]=function(){return iterator}),iterator}if(!self.URLSearchParams||"a=1"!==new self.URLSearchParams({a:1}).toString()){var __URLSearchParams__="__URLSearchParams__",prototype=URLSearchParams.prototype,iterable=!(!self.Symbol||!self.Symbol.iterator);prototype.append=function(name,value){var dict=this[__URLSearchParams__];name in dict?dict[name].push(""+value):dict[name]=[""+value]},prototype.delete=function(name){delete this[__URLSearchParams__][name]},prototype.get=function(name){var dict=this[__URLSearchParams__];return name in dict?dict[name][0]:null},prototype.getAll=function(name){var dict=this[__URLSearchParams__];return name in dict?dict[name].slice(0):[]},prototype.has=function(name){return name in this[__URLSearchParams__]},prototype.set=function(name,value){this[__URLSearchParams__][name]=[""+value]},prototype.forEach=function(callback,thisArg){var dict=this[__URLSearchParams__];Object.getOwnPropertyNames(dict).forEach(function(name){dict[name].forEach(function(value){callback.call(thisArg,value,name,this)},this)},this)},prototype.toString=function(){var i,key,name,value,dict=this[__URLSearchParams__],query=[];for(key in dict)for(name=encode(key),i=0,value=dict[key];i<value.length;i++)query.push(name+"="+encode(value[i]));return query.join("&")},prototype.sort=function(){var k,i,dict=this[__URLSearchParams__],keys=[],ret={};for(k in dict)keys.push(k);for(keys.sort(),i=0;i<keys.length;i++)ret[keys[i]]=dict[keys[i]];this[__URLSearchParams__]=ret},prototype.keys=function(){var items=[];return this.forEach(function(item,name){items.push([name])}),makeIterator(items)},prototype.values=function(){var items=[];return this.forEach(function(item){items.push([item])}),makeIterator(items)},prototype.entries=function(){var items=[];return this.forEach(function(item,name){items.push([name,item])}),makeIterator(items)},iterable&&(prototype[self.Symbol.iterator]=prototype.entries),self.URLSearchParams=URLSearchParams,self.URLSearchParams.polyfill=!0}}(void 0!==global?global:"undefined"!=typeof window?window:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(require,module,exports){"use strict";exports.__esModule=!0;var style_1=require("../style");exports.CO2_EMISSIONS_TODAY_ACTUAL=182e7,exports.CO2_EMISSIONS_MAX_NG=125e7,exports.CO2_EMISSIONS_GOAL=218e6,exports.INITIAL_POLICY={rps:0,carbon_tax:0,rps_includes_carbon_capture:0,rps_includes_nuclear_energy:0,solar_price:1,wind_price:1,nuclear_price:1,ng_price:1,nuclear_allowed:1,storage_allowed:1},exports.PRESET_POLICY={BALANCED_LOW_CARBON:{rps:0,carbon_tax:15,rps_includes_carbon_capture:0,rps_includes_nuclear_energy:0,solar_price:1,wind_price:1,nuclear_price:1,ng_price:1,nuclear_allowed:1,storage_allowed:1},FAVOR_RENEWABLES:{rps:17,carbon_tax:0,rps_includes_carbon_capture:0,rps_includes_nuclear_energy:0,solar_price:1,wind_price:1,nuclear_price:1,ng_price:1,nuclear_allowed:1,storage_allowed:1},FAVOR_CARBON_CAPTURE:{rps:17,carbon_tax:0,rps_includes_carbon_capture:1,rps_includes_nuclear_energy:0,solar_price:1,wind_price:1,nuclear_price:1,ng_price:1,nuclear_allowed:1,storage_allowed:1},FAVOR_NUCLEAR:{rps:17,carbon_tax:0,rps_includes_carbon_capture:0,rps_includes_nuclear_energy:1,solar_price:1,wind_price:1,nuclear_price:1,ng_price:1,nuclear_allowed:1,storage_allowed:1}},exports.PRESET_POLICY_DISPLAY_NAMES={BALANCED_LOW_CARBON:"Balanced low-carbon",FAVOR_RENEWABLES:"Favor renewables",FAVOR_CARBON_CAPTURE:"Favor carbon capture",FAVOR_NUCLEAR:"Favor nuclear"},exports.ALL_ENERGY_SOURCES=["nuclear","wind","solar","ng","ngccs","coal","coalccs","hydro"],exports.ALL_COST_SOURCES=["nuclear","wind","solar","ng","ngccs","coal","coalccs","hydro","storage"],exports.POLICY_BREAKDOWN_DISPLAY_NAMES={nuclear:"Nuclear",wind:"Wind",solar:"Solar",ng:"Natural gas",ngccs:"NG + CCS",coal:"Coal",coalccs:"Coal + CCS",hydro:"Hydropower",storage:"Storage"},exports.BREAKDOWN_COLORS={solar:style_1.COLORS.SOLAR_DARK,wind:style_1.COLORS.WIND,nuclear:style_1.COLORS.NUCLEAR_DARK,ng:style_1.COLORS.NG,ngccs:style_1.COLORS.NGCCS,coal:style_1.COLORS.COAL,coalccs:style_1.COLORS.COALCCS,hydro:style_1.COLORS.HYDRO,storage:style_1.COLORS.STORAGE};var BOOLEAN_DISPLAY_VALUES=["False","True"],TECH_PRICE_DISPLAY_VALUES=["Optimistic future","Moderate future","Today"],MARKET_PRICE_DISPLAY_VALUES=["Low cost","Medium cost","High cost"],booleanDimensionFormatter=function(dimensionLevel){return BOOLEAN_DISPLAY_VALUES[dimensionLevel]},techPriceDimensionFormatter=function(dimensionLevel){return TECH_PRICE_DISPLAY_VALUES[dimensionLevel]},marketPriceFormatter=function(dimensionLevel){return MARKET_PRICE_DISPLAY_VALUES[dimensionLevel]};exports.dimensionLevelFormatters={nuclear_allowed:booleanDimensionFormatter,storage_allowed:booleanDimensionFormatter,rps_includes_carbon_capture:booleanDimensionFormatter,rps_includes_nuclear_energy:booleanDimensionFormatter,rps:function(rpsPercent){return rpsPercent.toFixed(0)+"%"},carbon_tax:function(tax){return"$"+tax.toFixed(0)+"/t"},solar_price:techPriceDimensionFormatter,wind_price:techPriceDimensionFormatter,nuclear_price:techPriceDimensionFormatter,ng_price:marketPriceFormatter}},{"../style":27}],24:[function(require,module,exports){"use strict";function createPolicyPresets(onPresetSelectCallback){var presetElementConfig={BALANCED_LOW_CARBON:document.getElementById("preset-balanced-low-carbon"),FAVOR_RENEWABLES:document.getElementById("preset-favor-renewables"),FAVOR_CARBON_CAPTURE:document.getElementById("preset-favor-carbon-capture"),FAVOR_NUCLEAR:document.getElementById("preset-favor-nuclear")};return new presets_1.PresetOptionGroup(presetElementConfig,onPresetSelectCallback)}exports.__esModule=!0;var util=require("../util"),transforms=require("../transforms"),sweeps=require("./policy-index"),config=require("./config"),share=require("../compare-mode/share"),cost_1=require("../components/cost"),energy_breakdown_table_1=require("../components/energy-breakdown-table"),co2_bar_1=require("../components/co2-bar"),slider_1=require("../components/slider"),toggle_1=require("../components/toggle"),presets_1=require("../components/presets"),dataset_loader_1=require("./dataset-loader"),text_view_1=require("../components/text-view"),PolicyController=function(){function PolicyController(compareMode){this.policyDataset=null,this._components=[],this.compareMode=compareMode,this._currentDataView=null,this.sweepIndex=null,this._presetPolicies=null,this._datasetLoader=new dataset_loader_1.DatasetLoader,this._animateDataView=util.animate(this._updateDataView.bind(this),this._renderDataView.bind(this))}return PolicyController.prototype.fetchAndInit=function(schemaUrl,scenariosUrl){var _this=this;this._datasetLoader.load(schemaUrl,scenariosUrl).then(function(policyDataset){console.debug("[PolicyController] Dataset loaded. Initializing..."),_this.init(policyDataset)}).catch(function(reason){throw console.error("Could not load policy dataset.",reason),reason})},PolicyController.prototype.init=function(policyDataset){this.policyDataset=policyDataset,this.sweepIndex=new sweeps.NDArrayIndex(this.policyDataset),console.debug("Indexed policy dataset sweeps",this.sweepIndex);var initialPolicy=config.INITIAL_POLICY,urlState=share.readAppStateFromUrl(policyDataset.schema,window.location);urlState?(console.info("Loading policy state from url token: ",urlState.policy),initialPolicy=urlState.policy):console.info("No url state; using default initial policy: ",initialPolicy),this._initDisplayScales(),this._initComponents(initialPolicy),this._initCompareMode(),this._applyPolicyConfigToControls(initialPolicy);var content=document.getElementById("policy-mode-explorer");document.getElementById("policy-mode-loading").classList.remove("loading"),content.classList.remove("loading")},PolicyController.prototype._applyPolicyConfigToControls=function(newConfig){var _this=this;this.policyDataset.schema.dimensions.forEach(function(dimension){var newDimensionLevel=newConfig[dimension],slider=_this._sliders[dimension];if(slider)return void slider.setValue(newDimensionLevel);var toggle=_this._toggles[dimension];if(toggle)return void toggle.setValue(Boolean(newDimensionLevel));throw new Error('Unsupported configuration preset dimension "'+dimension+'".')})},PolicyController.prototype._getDataView=function(choices){var policySummary=this.sweepIndex.select(choices),BASELINE=sweeps.parsePolicyRowCSV(this.policyDataset.schema.baseline,this.policyDataset.schema);return{choices:choices,summary:policySummary,population:this.policyDataset.schema.population,baseline:BASELINE,deltaToRef:transforms.deltas(BASELINE,policySummary)}},PolicyController.prototype._handlePresetSelect=function(presetKey){this._applyPolicyConfigToControls(config.PRESET_POLICY[presetKey])},PolicyController.prototype._initDisplayScales=function(){var booleanDisplayScales=["False","True"];this._displayScales={nuclear_allowed:booleanDisplayScales,storage_allowed:booleanDisplayScales,rps_includes_carbon_capture:booleanDisplayScales,rps_includes_nuclear_energy:booleanDisplayScales,rps:this.policyDataset.schema.scales.rps.map(function(p){return p.toFixed(0)+"%"}),carbon_tax:this.policyDataset.schema.scales.carbon_tax.map(function(t){return"$"+t.toFixed(0)+"/t"}),solar_price:this.policyDataset.schema.scales.solar_price.map(function(n){return"Solar farm"}),wind_price:this.policyDataset.schema.scales.wind_price.map(function(n){return"Wind farm"}),nuclear_price:this.policyDataset.schema.scales.nuclear_price.map(function(n){return"Nuclear plant"}),ng_price:this.policyDataset.schema.scales.ng_price.map(function(n){return"Natural gas fuel"})}},PolicyController.prototype._initCompareMode=function(){var _this=this,referencePolicyViews={};Object.keys(config.PRESET_POLICY).forEach(function(name){referencePolicyViews[name]=_this._getDataView(config.PRESET_POLICY[name])}),this.compareMode.init(referencePolicyViews,this._currentDataView)},PolicyController.prototype._renderDataView=function(){var _this=this;this._components.forEach(function(c){return c.update(_this._currentDataView)});var newAppState={policy:this._currentDataView.choices};share.updateUrlForAppState(newAppState,this.policyDataset.schema,window.location,window.history)},PolicyController.prototype._updateDataView=function(newView){this._currentDataView=newView},PolicyController.prototype._updateDimension=function(dimension,newLevel){var policyChoices={};util.shallowCopy(this._currentDataView.choices,policyChoices),policyChoices[dimension]=newLevel,this._animateDataView(this._getDataView(policyChoices)),this._presetPolicies.deselectAll()},PolicyController.prototype._initComponents=function(initialPolicy){var _this=this;this._currentDataView=this._getDataView(initialPolicy),[new cost_1.BaselineCost(document.getElementById("policy-mode-cost-eq-baseline")),new cost_1.BaselineDeltaCost(document.getElementById("policy-mode-cost-eq-delta")),new cost_1.TotalCost(document.getElementById("policy-mode-cost-eq-total")),new co2_bar_1.CO2GoalChart(document.getElementById("policy-mode-goal-chart"),this._currentDataView,{data:{max:this.policyDataset.schema.stats.co2.max,markers:[{value:0,label:""},{value:this.policyDataset.schema.stats.co2.max,label:""},{value:config.CO2_EMISSIONS_MAX_NG,label:"Max NG"},{value:config.CO2_EMISSIONS_TODAY_ACTUAL,label:"Today"},{value:config.CO2_EMISSIONS_GOAL,label:"Goal"}]},bar:{height:40,width:760},padding:{bottom:50},text:{offset:{y:6}}}),new energy_breakdown_table_1.PolicyBreakdownTable(document.getElementById("policy-mode-breakdown-table"),this._currentDataView,config.ALL_COST_SOURCES,config.POLICY_BREAKDOWN_DISPLAY_NAMES),new text_view_1.TextView(document.getElementById("ng-cost-slider-value"),function(view){return config.dimensionLevelFormatters.ng_price(view.choices.ng_price)}),new text_view_1.TextView(document.getElementById("solar-cost-slider-value"),function(view){return config.dimensionLevelFormatters.solar_price(view.choices.solar_price)}),new text_view_1.TextView(document.getElementById("wind-cost-slider-value"),function(view){return config.dimensionLevelFormatters.wind_price(view.choices.wind_price)}),new text_view_1.TextView(document.getElementById("nuclear-cost-slider-value"),function(view){return config.dimensionLevelFormatters.nuclear_price(view.choices.nuclear_price)})].forEach(function(c){return _this._components.push(c)}),this._presetPolicies=createPolicyPresets(this._handlePresetSelect.bind(this)),this._sliders={rps:new slider_1.Slider(document.getElementById("ces-slider"),0,this.policyDataset.schema.scales.rps.length-1,1,this._currentDataView.choices.rps,this._displayScales.rps),carbon_tax:new slider_1.Slider(document.getElementById("carbon-tax-slider"),0,this.policyDataset.schema.scales.carbon_tax.length-1,1,this._currentDataView.choices.carbon_tax,this._displayScales.carbon_tax),solar_price:new slider_1.Slider(document.getElementById("solar-cost-slider"),0,this.policyDataset.schema.scales.solar_price.length-1,1,this._currentDataView.choices.solar_price,this._displayScales.solar_price),wind_price:new slider_1.Slider(document.getElementById("wind-cost-slider"),0,this.policyDataset.schema.scales.wind_price.length-1,1,this._currentDataView.choices.wind_price,this._displayScales.wind_price),nuclear_price:new slider_1.Slider(document.getElementById("nuclear-cost-slider"),0,this.policyDataset.schema.scales.nuclear_price.length-1,1,this._currentDataView.choices.nuclear_price,this._displayScales.nuclear_price),ng_price:new slider_1.Slider(document.getElementById("ng-cost-slider"),0,this.policyDataset.schema.scales.ng_price.length-1,1,this._currentDataView.choices.ng_price,this._displayScales.ng_price)},Object.keys(this._sliders).forEach(function(dimension){_this._sliders[dimension].addChangeListener(function(newLevel){_this._updateDimension(dimension,newLevel)})}),this._toggles={rps_includes_carbon_capture:new toggle_1.OptionToggle(document.getElementById("checkbox-ccs-is-clean")),rps_includes_nuclear_energy:new toggle_1.OptionToggle(document.getElementById("checkbox-nuclear-is-clean")),nuclear_allowed:new toggle_1.OptionToggle(document.getElementById("checkbox-nuclear-is-allowed")),storage_allowed:new toggle_1.OptionToggle(document.getElementById("checkbox-storage-is-allowed"))},Object.keys(this._toggles).forEach(function(dimension){_this._toggles[dimension].addChangeListener(function(newValue){var newLevel=Number(newValue);_this._updateDimension(dimension,newLevel)})}),this._toggles.nuclear_allowed.addChangeListener(function(isNuclearAllowed){isNuclearAllowed?(_this._sliders.nuclear_price.enable(),_this._toggles.rps_includes_nuclear_energy.enable()):(_this._sliders.nuclear_price.disable(),_this._toggles.rps_includes_nuclear_energy.disable())}),{policy:[document.getElementById("go-to-policy-mode-button")],utility:[document.getElementById("go-to-utility-mode-button"),document.getElementById("go-to-utility-mode-button-2")],compare:[document.getElementById("go-to-compare-mode-button")]}.compare.forEach(function(compareButton){compareButton.addEventListener("click",function(event){console.debug("[click] go-to-compare-mode",_this._currentDataView),_this.compareMode.update(_this._currentDataView)})})},PolicyController}();exports.PolicyController=PolicyController},{"../compare-mode/share":3,"../components/co2-bar":4,"../components/cost":6,"../components/energy-breakdown-table":7,"../components/presets":10,"../components/slider":11,"../components/text-view":12,"../components/toggle":13,"../transforms":28,"../util":29,"./config":23,"./dataset-loader":25,"./policy-index":26}],25:[function(require,module,exports){"use strict";exports.__esModule=!0;var es6_promise_1=require("es6-promise"),DatasetLoader=function(){function DatasetLoader(){}return DatasetLoader.prototype.load=function(schemaUrl,scenariosUrl){var promisedScenarios=new es6_promise_1.Promise(this._fetchDatasetScenarios.bind(this,scenariosUrl)),promisedSchema=new es6_promise_1.Promise(this._fetchDatasetSchema.bind(this,schemaUrl));return es6_promise_1.Promise.all([promisedScenarios,promisedSchema]).then(function(_a){var scenarios=_a[0],schema=_a[1],dataset={scenarios:scenarios,schema:schema};return console.debug("[DatasetLoader] Dataset loaded.",dataset),dataset}).catch(function(reason){throw console.error("Failed to load policy dataset. Reason: ",reason),reason})},DatasetLoader.prototype._fetchDatasetScenarios=function(url,resolve,reject){d3.csv(url,function(error,scenarios){error&&reject(new Error("Failed to load policy dataset scenarios.")),console.debug("[Retrieved] policy mode scenario dataset: "+scenarios.length+" rows"),resolve(scenarios)})},DatasetLoader.prototype._fetchDatasetSchema=function(url,resolve,reject){d3.json(url,function(error,schema){error&&reject(new Error("Failed to load policy dataset schema.")),console.debug("[Retrieved] policy mode dataset schema",schema),resolve(schema)})},DatasetLoader}();exports.DatasetLoader=DatasetLoader},{"es6-promise":17}],26:[function(require,module,exports){"use strict";function parsePolicyRowCSV(row,schema){var outcome={co2:null,cost:null,energy:0,breakdown:{solar:{},wind:{},ng:{},ngccs:{},nuclear:{},hydro:{},coal:{},coalccs:{},storage:{}}};return schema.facts.forEach(function(fact){var field,source,tokens=fact.split("_");if(1==tokens.length)field=tokens[0],outcome[field]=parseFloat(row[fact]);else{if(2!=tokens.length)throw new Error("Unexpected field structure has more than 2 tokens:\n          "+fact+" => "+tokens);source=tokens[0],field=tokens[1];var fact_value=parseFloat(row[fact]);outcome.breakdown[source][field]=fact_value,"energy"==field&&(outcome.energy+=fact_value)}}),outcome}exports.__esModule=!0;var ndarray=require("ndarray"),NDArrayIndex=function(){function NDArrayIndex(dataset){this._dataset=dataset,this._flatIndex=null,this._hypercubeIndex=null,this._buildIndex()}return NDArrayIndex.prototype.select=function(policy){return this._getScenario(policy)},NDArrayIndex.prototype._asDimensionIndex=function(policy){return this._dataset.schema.dimensions.map(function(d){return policy[d]})},NDArrayIndex.prototype._buildIndex=function(){for(var flatIndex=[],i=0;i<this._dataset.scenarios.length;++i)flatIndex.push(i);return this._flatIndex=flatIndex,this._hypercubeIndex=ndarray(this._flatIndex,this._dataset.schema.shape),this},NDArrayIndex.prototype._getScenario=function(policy){this._dataset.schema.dimensions.forEach(function(dimension){if(void 0==policy[dimension]||null==policy[dimension])throw new Error("Policy lookup key missing dimension level for           "+dimension+": "+policy)});var flatIndex=this._hypercubeIndex.get.apply(this._hypercubeIndex,this._asDimensionIndex(policy));return this._getScenarioOutcome(flatIndex)},NDArrayIndex.prototype._getScenarioOutcome=function(flatIndex){return parsePolicyRowCSV(this._dataset.scenarios[flatIndex],this._dataset.schema)},NDArrayIndex.prototype._getSlice=function(policy){var sliceDimension=null;if(Object.keys(policy).forEach(function(dimension){null==policy[dimension]&&(sliceDimension=dimension)}),null===sliceDimension)throw new Error("Slice selection key must specify exactly 1 dimension as null;         no slice dimensions found");var view=this._hypercubeIndex.pick.apply(this._hypercubeIndex,this._asDimensionIndex(policy));if(view.shape.length>1)throw new Error("Slice selection key must exactly 1 dimension as null; attempted to         slice "+view.shape.length+" dimensions");for(var slicedScenarios=[],i=0;i<view.shape[0];++i){var flatIndex=view.get(i);slicedScenarios.push(this._getScenarioOutcome(flatIndex))}return{dimension:sliceDimension,scenarios:slicedScenarios}},NDArrayIndex}();exports.NDArrayIndex=NDArrayIndex,exports.parsePolicyRowCSV=parsePolicyRowCSV},{ndarray:20}],27:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.COLORS={PRIMARY:"#3f51b5",ACCENT_PRIMARY:"#8C9EFF",LIGHT_GRAY:"#dfdfdf",WHITE:"#fff",BLACK:"#000",SOLAR:"#FFD600",SOLAR_LIGHT:"#FFF59D",SOLAR_DARK:"#FFAB00",WIND:"#41b6c4",NUCLEAR:"#a1dab4",NUCLEAR_DARK:"#4DB6AC",NG:"#225ea8",NGCCS:"#1d91c0",COAL:"#cb181d",COALCCS:"#fb6a4a",HYDRO:"#9ecae1",STORAGE:"#8c6bb1",FAILURE:"#FF1744",DEMAND:"#F0F0F0",EXCESS_LIGHT:"#ffffff",EXCESS:"#BDBDBD"}},{}],28:[function(require,module,exports){"use strict";function perMWhCost(cost,yearlyConsumed){return cost/exports.DISCOUNT_RATE_YEARLY/yearlyConsumed}function asMonthlyPerHouseholdCost(cost,population){return cost/population*MONTHLY_COST_PER_HOUSEHOLD_FACTOR}function deltas(baseline,current){function delta(ref,value){return(value-ref)/ref}return{co2:delta(baseline.co2,current.co2),cost:delta(baseline.cost,current.cost)}}function totalCost(view){return perMWhCost(view.summary.cost,view.summary.energy)}function baselineCost(view){return perMWhCost(view.baseline.cost,view.baseline.energy)}function baselineDeltaCost(view){var baselineCost=perMWhCost(view.baseline.cost,view.baseline.energy);return perMWhCost(view.summary.cost,view.summary.energy)-baselineCost}function resourceCost(view,source){return totalCost(view)*costFraction(view,source)}function costFraction(view,source){return view.summary.breakdown[source].cost/view.summary.cost}function energyFraction(view,source){return view.summary.breakdown[source].energy/view.summary.energy}exports.__esModule=!0,exports.MONTHS_PER_YEAR=12,exports.WEEKS_PER_YEAR=52,exports.DISCOUNT_RATE_YEARLY=14.6,exports.DISCOUNT_RATE_WEEKLY=exports.DISCOUNT_RATE_YEARLY*exports.WEEKS_PER_YEAR;var MONTHLY_COST_PER_HOUSEHOLD_FACTOR=2.53/(exports.MONTHS_PER_YEAR*exports.DISCOUNT_RATE_YEARLY);exports.perMWhCost=perMWhCost,exports.asMonthlyPerHouseholdCost=asMonthlyPerHouseholdCost,exports.deltas=deltas,exports.totalCost=totalCost,exports.baselineCost=baselineCost,exports.baselineDeltaCost=baselineDeltaCost,exports.resourceCost=resourceCost,exports.costFraction=costFraction,exports.energyFraction=energyFraction},{}],29:[function(require,module,exports){"use strict";function sum(series){var total=0;return series.forEach(function(x){return total+=x}),total}function max(series){var maxSoFar=-1/0;return series.forEach(function(x){return maxSoFar=Math.max(maxSoFar,x)}),maxSoFar}function selectElements(querySelector){var nodeList=document.querySelectorAll(querySelector);return Array.prototype.slice.call(nodeList)}function throttle(fn,delay){var timer=null;return function(){timer||(fn.apply(this,arguments),timer=setTimeout(function(){timer=null},delay))}}function mergeDeep(source,destination){Object.keys(source).forEach(function(k){source[k]&&"object"==typeof source[k]&&destination[k]&&"object"==typeof destination[k]?mergeDeep(source[k],destination[k]):destination[k]=source[k]})}function sortNumericAscending(a,b){return parseInt(a)-parseInt(b)}function animate(update,render){function wrappedRender(){render.apply(null,arguments),isAnimating=!1}function wrappedUpdate(){update.apply(null,arguments),isAnimating||window.requestAnimationFrame(wrappedRender),isAnimating=!0}var isAnimating=!1;return wrappedUpdate}function base64Encode(o){return btoa(JSON.stringify(o))}function base64Decode(s){return JSON.parse(atob(s))}exports.__esModule=!0,exports.shallowCopy=function(source,dest){return Object.keys(source).forEach(function(k){return dest[k]=source[k]}),dest},exports.sum=sum,exports.max=max,exports.selectElements=selectElements,exports.throttle=throttle,exports.mergeDeep=mergeDeep,exports.sortNumericAscending=sortNumericAscending,exports.animate=animate,exports.base64Encode=base64Encode,exports.base64Decode=base64Decode},{}],30:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.CO2_EMISSIONS_TODAY=811e5,exports.CO2_EMISSIONS_GOAL=158e5,exports.CO2_EMISSIONS_MAX=18e7,exports.BASELINE={cost:104e9,co2:57e6,energy:28e7,breakdown:null},exports.POPULATION=391e5,exports.FIXED_COST={ng:770633,solar:1356035,wind:2181533,nuclear:4667258,coal:3388939,ngccs:1505159,coalccs:4559261},exports.VARIABLE_COST={ng:32.1,nuclear:12,solar:0,wind:0,coal:23.3,ngccs:47.7,coalccs:42.9},exports.CO2_RATE={ng:.4538,nuclear:0,solar:0,wind:0,coal:.8582,ngccs:.0549,coalccs:.1013},exports.PRESET_ALLOCATIONS={NUCLEAR:{solar:0,wind:0,ng:.53,nuclear:.71,coal:0,coalccs:0,ngccs:0},WIND:{solar:0,wind:.66,ng:.76,nuclear:0,coal:0,coalccs:0,ngccs:0},SOLAR:{solar:.5,wind:0,ng:1,nuclear:0,coal:0,coalccs:0,ngccs:0},BALANCED:{solar:.19,wind:.26,ng:.5,nuclear:.42,coal:.1,coalccs:0,ngccs:0}},exports.NON_DISPATCHABLE_ENERGY_SOURCES=["solar","wind","nuclear","coal","coalccs"],exports.DISPATCHABLE_ENERGY_SOURCES=["ng","ngccs"],exports.ALL_ENERGY_SOURCES=exports.DISPATCHABLE_ENERGY_SOURCES.concat(exports.NON_DISPATCHABLE_ENERGY_SOURCES),exports.SLIDER_ENERGY_SOURCES=["solar","wind","nuclear","coal","ng"]},{}],31:[function(require,module,exports){"use strict";function createUtilityPresets(sliders){var presetElementConfig={NUCLEAR:document.getElementById("preset-util-nuclear"),SOLAR:document.getElementById("preset-util-solar"),WIND:document.getElementById("preset-util-wind"),BALANCED:document.getElementById("preset-util-balanced")},utilityPresetCallback=function(presetKey){var presetAllocations=config.PRESET_ALLOCATIONS[presetKey];config.SLIDER_ENERGY_SOURCES.forEach(function(source){sliders[source].setValue(100*presetAllocations[source])})};return new presets_1.PresetOptionGroup(presetElementConfig,utilityPresetCallback)}exports.__esModule=!0;var profiles=require("./profiles"),util=require("../util"),config=require("./config"),transforms=require("../transforms"),toggle_1=require("../components/toggle"),presets_1=require("../components/presets"),unmet_demand_1=require("./unmet-demand"),cost_1=require("../components/cost"),slider_1=require("../components/slider"),co2_bar_1=require("../components/co2-bar"),energy_profiles_1=require("../components/energy-profiles"),UtilityController=function(){function UtilityController(dataUrl){var _this=this;this.dataUrl=dataUrl,this._components=[],this._useCCS=!1,this._animateDataView=util.animate(function(newView){_this._dataView=newView},function(){return _this._components.forEach(function(c){c.update(_this._dataView)})})}return UtilityController.prototype.init=function(){d3.json(this.dataUrl,this._handleDataLoaded.bind(this))},UtilityController.prototype._asUtilityDataView=function(allocations,profiles,outcome){return{allocations:allocations,profiles:profiles,summary:outcome,population:config.POPULATION,baseline:config.BASELINE,deltaToRef:transforms.deltas(config.BASELINE,outcome)}},UtilityController.prototype._handleDataLoaded=function(error,profileDataset){if(error)throw new Error("Failed to load profile dataset.");this.profileDataset=profileDataset,console.debug("Loaded energy profile dataset",profileDataset),this._initCCSControl(),this._initComponents()},UtilityController.prototype._initCCSControl=function(){var _this=this,ccsToggles={ng:new toggle_1.OptionToggle(document.getElementById("checkbox-utility-ng-ccs")),coal:new toggle_1.OptionToggle(document.getElementById("checkbox-utility-coal-ccs"))},ccsContextElements={ng:[document.getElementById("utility-controls-option-ng")],coal:[document.getElementById("utility-controls-option-coal")]};Object.keys(ccsToggles).forEach(function(source){ccsToggles[source].addChangeListener(function(enableCCS){var ccsSource=source+"ccs",allocations=_this._dataView.allocations,sourceAllocation=Math.max(allocations[source],allocations[ccsSource]);enableCCS?(allocations[ccsSource]=sourceAllocation,allocations[source]=0,ccsContextElements[source].forEach(function(el){return el.classList.add("ccs")})):(allocations[ccsSource]=0,allocations[source]=sourceAllocation,ccsContextElements[source].forEach(function(el){return el.classList.remove("ccs")})),_this._updateAllocations(allocations)})}),this._ccsToggles=ccsToggles},UtilityController.prototype._updateAllocations=function(allocations){var allocatedProfiles=profiles.getAllocatedEnergyProfiles(allocations,this.profileDataset),summary=profiles.summarize(allocatedProfiles),newView=this._asUtilityDataView(allocations,allocatedProfiles,summary),perMWhBreakdown={};config.ALL_ENERGY_SOURCES.forEach(function(source){var cost=newView.summary.breakdown[source].cost,consumed=newView.summary.breakdown[source].consumed;perMWhBreakdown[source]={cost:cost,consumed:consumed,perMWh:transforms.perMWhCost(cost,52*consumed)}}),this._animateDataView(newView)},UtilityController.prototype._initComponents=function(){function getDisplayValues(series){var maxPower=d3.max(series);return d3.range(0,101).map(function(percent){return sliderFormatter(maxPower/1e3*(percent/100))})}var _this=this,allocations={solar:void 0,wind:void 0,nuclear:void 0,ng:void 0,coal:void 0,ngccs:void 0,coalccs:void 0};util.shallowCopy(config.PRESET_ALLOCATIONS.BALANCED,allocations);var allocatedProfiles=profiles.getAllocatedEnergyProfiles(allocations,this.profileDataset),updatedSummary=profiles.summarize(allocatedProfiles),utilityDataView=this._asUtilityDataView(allocations,allocatedProfiles,updatedSummary);this._profilesChart=new energy_profiles_1.SupplyDemandProfilesChart(document.getElementById("utility-mode-profiles-chart"),utilityDataView,{}),this._components.push(this._profilesChart);var CO2_CHART_DATA_CONFIG={max:config.CO2_EMISSIONS_MAX,markers:[{value:0,label:""},{value:config.CO2_EMISSIONS_MAX,label:""},{value:config.CO2_EMISSIONS_TODAY,label:"Today"},{value:config.CO2_EMISSIONS_GOAL,label:"Goal"}]};this._components.push(new co2_bar_1.CO2GoalChart(document.getElementById("utility-mode-goal-progress"),utilityDataView,{data:CO2_CHART_DATA_CONFIG,bar:{width:375},ticks:{alignThreshold:5}})),this._components.push(new cost_1.TotalCost(document.getElementById("utility-mode-cost")));var sliderFormatter=d3.format(".1f"),sliders={solar:new slider_1.Slider(document.getElementById("solar-slider"),0,100,1,Math.floor(100*allocations.solar),getDisplayValues(this.profileDataset.series.solar)),wind:new slider_1.Slider(document.getElementById("wind-slider"),0,100,1,Math.floor(100*allocations.wind),getDisplayValues(this.profileDataset.series.wind)),nuclear:new slider_1.Slider(document.getElementById("nuclear-slider"),0,100,1,Math.floor(100*allocations.nuclear),getDisplayValues(this.profileDataset.series.nuclear)),ng:new slider_1.Slider(document.getElementById("ng-slider"),0,100,1,Math.floor(100*allocations.ng),getDisplayValues(this.profileDataset.series.ng)),coal:new slider_1.Slider(document.getElementById("coal-slider"),0,100,1,Math.floor(100*allocations.coal),getDisplayValues(this.profileDataset.series.coal))};this._components.push(new unmet_demand_1.UnmetEnergyDemand([document.getElementById("utility-outcome-summary-unmet"),document.getElementById("utility-outcome-summary")])),config.SLIDER_ENERGY_SOURCES.forEach(function(source){sliders[source].addChangeListener(function(newValue){var newAllocation=newValue/100,ccsToggle=_this._ccsToggles[source];if(ccsToggle){var ccsEnabled=ccsToggle.getValue(),ccsSource=source+"ccs"
;ccsEnabled?(allocations[ccsSource]=newAllocation,allocations[source]=0):(allocations[ccsSource]=0,allocations[source]=newAllocation)}else allocations[source]=newAllocation;_this._updateAllocations(allocations)})});var presetAllocations=createUtilityPresets(sliders);Object.keys(sliders).forEach(function(source){sliders[source].addChangeListener(function(newValue){presetAllocations.deselectAll()})}),presetAllocations.select("BALANCED")},UtilityController}();exports.UtilityController=UtilityController},{"../components/co2-bar":4,"../components/cost":6,"../components/energy-profiles":8,"../components/presets":10,"../components/slider":11,"../components/toggle":13,"../transforms":28,"../util":29,"./config":30,"./profiles":32,"./unmet-demand":33}],32:[function(require,module,exports){"use strict";function getSuppliedEnergyBreakdown(profiles){var supplied={};config.ALL_ENERGY_SOURCES.forEach(function(source){return supplied[source]=0});for(var t=0;t<profiles.index.length;++t)!function(t){var demand=profiles.series.demand[t],nonDispatchableGenerated=util.sum(config.NON_DISPATCHABLE_ENERGY_SOURCES.map(function(s){return profiles.series[s][t]})),excess=nonDispatchableGenerated-demand;excess>0?config.NON_DISPATCHABLE_ENERGY_SOURCES.map(function(source){var generated=profiles.series[source][t],sourceExcess=generated*excess/nonDispatchableGenerated;supplied[source]+=generated-sourceExcess}):config.NON_DISPATCHABLE_ENERGY_SOURCES.map(function(source){supplied[source]+=profiles.series[source][t]}),config.DISPATCHABLE_ENERGY_SOURCES.forEach(function(source){supplied[source]+=profiles.series[source][t]})}(t);return supplied}function getFixedCost(capacity,source){return capacity*config.FIXED_COST[source]}function getVariableCost(energy,source){return energy*config.VARIABLE_COST[source]*transforms.DISCOUNT_RATE_WEEKLY}function getCo2(energy,source){return energy*config.CO2_RATE[source]*transforms.WEEKS_PER_YEAR}function getAllocatedEnergyProfiles(allocations,profiles){if(allocations.ng>0&&allocations.ngccs>0)throw new Error("Unsupported allocation of multiple dispatchable energy sources");for(var allocatedProfiles={solar:profiles.series.solar.map(function(x){return x*allocations.solar}),wind:profiles.series.wind.map(function(x){return x*allocations.wind}),nuclear:profiles.series.nuclear.map(function(x){return x*allocations.nuclear}),ng:profiles.series.ng.map(function(x){return x*allocations.ng}),coal:profiles.series.coal.map(function(x){return x*allocations.coal}),ngccs:profiles.series.ngccs.map(function(x){return x*allocations.ngccs}),coalccs:profiles.series.coalccs.map(function(x){return x*allocations.coalccs})},unmetProfile=[],dispatchProfile=[],supplyProfile=[],i=0;i<profiles.series.demand.length;++i)!function(i){var supplied=0;config.NON_DISPATCHABLE_ENERGY_SOURCES.forEach(function(name){supplied+=allocatedProfiles[name][i]});var needed=Math.max(profiles.series.demand[i]-supplied,0),dispatchAvailable=Math.max(allocatedProfiles.ng[i],allocatedProfiles.ngccs[i]),dispatched=0,unmet=0;dispatchAvailable>=needed?(dispatched=needed,unmet=0):(dispatched=dispatchAvailable,unmet=needed-dispatched),supplied+=dispatched,dispatchProfile.push(dispatched),unmetProfile.push(unmet),supplyProfile.push(supplied)}(i);return{index:profiles.index,units:profiles.units,series:{demand:profiles.series.demand,unmet:unmetProfile,supply:supplyProfile,solar:allocatedProfiles.solar,wind:allocatedProfiles.wind,nuclear:allocatedProfiles.nuclear,coal:allocatedProfiles.coal,coalccs:allocatedProfiles.coalccs,ng:allocations.ng>0?dispatchProfile:allocatedProfiles.ng,ngccs:allocations.ngccs>0?dispatchProfile:allocatedProfiles.ngccs}}}function summarize(profiles){var supplyBreakdown=getSuppliedEnergyBreakdown(profiles),breakdown={ng:null,solar:null,wind:null,nuclear:null,coal:null,ngccs:null,coalccs:null};return config.ALL_ENERGY_SOURCES.forEach(function(source){var profileEnergy=util.sum(profiles.series[source]),profileCapacity=util.max(profiles.series[source]);breakdown[source]={capacity:profileCapacity,energy:profileEnergy,consumed:supplyBreakdown[source],fixedCost:getFixedCost(profileCapacity,source),variableCost:getVariableCost(profileEnergy,source),co2:getCo2(profileEnergy,source)},breakdown[source].cost=breakdown[source].fixedCost+breakdown[source].variableCost}),{co2:util.sum(Object.keys(breakdown).map(function(s){return breakdown[s].co2})),cost:util.sum(Object.keys(breakdown).map(function(s){return breakdown[s].fixedCost+breakdown[s].variableCost})),energy:util.sum(Object.keys(breakdown).map(function(s){return breakdown[s].consumed*transforms.WEEKS_PER_YEAR})),breakdown:breakdown}}exports.__esModule=!0;var config=require("./config"),util=require("../util"),transforms=require("../transforms");exports.getSuppliedEnergyBreakdown=getSuppliedEnergyBreakdown,exports.getAllocatedEnergyProfiles=getAllocatedEnergyProfiles,exports.summarize=summarize},{"../transforms":28,"../util":29,"./config":30}],33:[function(require,module,exports){"use strict";exports.__esModule=!0;var util=require("../util");exports.CSS_UNMET_DEMAND_CLASS="unmet";var UnmetEnergyDemand=function(){function UnmetEnergyDemand(contextElements){this._contextElements=contextElements}return UnmetEnergyDemand.prototype.update=function(view){var unmetSeries=view.profiles.series.unmet;util.sum(unmetSeries)>0?this._contextElements.forEach(function(el){el.classList.add(exports.CSS_UNMET_DEMAND_CLASS)}):this._contextElements.forEach(function(el){el.classList.remove(exports.CSS_UNMET_DEMAND_CLASS)})},UnmetEnergyDemand}();exports.UnmetEnergyDemand=UnmetEnergyDemand},{"../util":29}]},{},[15]);
